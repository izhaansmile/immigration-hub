<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Immigration Resource Hub</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Documented NY — Latest 20 English Articles</h1>
  <div id="news">Loading articles...</div>

  <script>
    function isMostlyEnglish(text) {
      const englishWords = ['the', 'and', 'you', 'that', 'was', 'for', 'with', 'have', 'this', 'but'];
      text = text.toLowerCase();

      const englishChars = text.match(/[a-z\s]/g) || [];
      const ratio = englishChars.length / text.length;
      if (ratio < 0.7) return false;

      return englishWords.some(word => text.includes(word));
    }

    fetch("https://api.rss2json.com/v1/api.json?rss_url=https://documentedny.com/feed/")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("news");
        container.innerHTML = '';

        const englishItems = data.items.filter(item => {
          const content = (item.title + " " + item.description).toLowerCase();
          return isMostlyEnglish(content);
        });

        if (englishItems.length === 0) {
          container.innerHTML = "<p>No English articles found.</p>";
          return;
        }
        
          const filtered = data.items.filter(item => {
          const text = (item.title + " " + item.description);
          const lang = franc.min(text);
          return lang === 'eng'; // only keep English articles
        });
        
        englishItems.slice(0, 20).forEach(item => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <a href="${item.link}" target="_blank" rel="noopener">${item.title}</a>
            <time>${new Date(item.pubDate).toLocaleDateString()}</time>
            <p>${item.description}</p>
          `;
          container.appendChild(div);
        });
      })
      .catch(err => {
        console.error(err);
        document.getElementById("news").innerHTML = "<p>Error loading articles.</p>";
      });
  </script>
  <footer>
    <p>Last updated: July 2025 • Built for community use</p>
  </footer
</body>
</html>